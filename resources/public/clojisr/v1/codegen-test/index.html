<!DOCTYPE html>
<html><html><head><script language="JavaScript">
  socket= new WebSocket('ws://localhost:5678/watch-reload');
  socket.onopen= function() {
                           socket.send ('watch') ;
                           };
  socket.onmessage= function(s) {
                               if                                                          ( s.data == 'started') {
                                                                                                                   console.log ("Watching started") ;
                                                                                                                   }                                 else                   if ( s.data == 'reload') {
                                                                                                                                                                                                      console.log            ("reloading") ;
                                                                                                                                                                                                      window.location.reload ()            ;
                                                                                                                                                                                                      } else                   {
                                                                                                                                                                                                                                alert('Don\'t know what to do with [' + s.data + ']');
                                                                                                                                                                                                                                }
                               };
  </script>
  <style type="text/css">body {
    background-image: linear-gradient(0deg, #fff4e8 25%, #fef8e9 25%, #fef8e9 50%, #fff4e8 50%, #fff4e8 75%, #fef8e9 75%, #fef8e9 100%);
    background-size: 32.00px 32.00px;
    color: #3e3c3f;
    font-family: "Source Sans Pro", sans-serif;
    font-size: 14px;
    padding-left: 10px;
    padding-right: 10px;
    margin: 0;
}

.nspin {
    border-radius: 10px;
    background: #d7d2c3;
    padding: 10px;
    margin-bottom: 5px;
}

.nspout {
    border-radius: 10px;
    background: #e4ded0;
    padding: 10px;
    margin-left: 10px;
}

.nspbox {
    padding-bottom: 5px;
    margin: 0;
}

.FAILED { color: #bb0000; }
.PASSED { color: #009500; }

p {
    margin-top: 0;
    margin-bottom: 5px; }

h1, h2, h3, h4, h5, h6 {
    margin-top: 10px;
    margin-bottom: 5px;
    color: #720000;
}

a:visited { color: #5E5E59; }
a:link { color: #720000; }
tr:nth-child(even) { background-color: #e4ded0; }
th { background-color: #d7d2c3; }

</style><script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/lang-clj.js" type="text/javascript"></script><link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" /><script src="https://code.jquery.com/jquery-3.4.1.min.js" type="text/javascript"></script><script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" type="text/javascript"></script><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /></head><body><div><h1>clojisr.v1.codegen-test</h1><div><i><small><a href="https://github.com/scicloj/clojisr/tree/master/test/clojisr/v1/codegen_test.clj">clojisr.v1.codegen-test</a> - created by <a href="https://github.com/scicloj/notespace">notespace</a>, Tue Mar 24 01:05:35 CET 2020.</small></i><hr /></div><div>Checks: <b class="PASSED">41 PASSED </b><hr /></div><div>Table of contents<ul><li><a href="#r-code-as-a-string">r-code-as-a-string</a></li><li><a href="#r-object">r-object</a></li><li><a href="#clojure-forms">clojure-forms</a></li><li><a href="#calling-R-functions">calling-R-functions</a></li></ul><hr /></div><div class="nspbox"><div><h1>R code generation from the Clojure forms</h1></div></div><div class="nspbox"><div><p>R code in <code>clojisr</code> library can be represented in three main ways:</p><ul><li>as string containing R code or script</li><li>as RObject</li><li>as Clojure form</li></ul><p>RObject is <code>clojisr</code> data structure which keeps reference to R objects. Also can act as a function when referenced object is R function. RObject is returned always when R code is executed.</p><p>Let's see what is possible in detail. </p><p>First, require the necessary namespaces.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(require</br>&nbsp;&nbsp;&nbsp;'[clojisr.v1.rserve&nbsp;:as&nbsp;rserve]</br>&nbsp;&nbsp;&nbsp;'[clojisr.v1.r&nbsp;:as&nbsp;r&nbsp;:refer</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[r&nbsp;->code&nbsp;r->clj]]</br>&nbsp;&nbsp;&nbsp;'[notespace.v2.note&nbsp;:refer&nbsp;[check]])</code></div></div><div class="nspbox"><div><p>Also, let us make sure we are using a clean session.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(rserve/set-as-default!)</br>&nbsp;(r/discard-all-sessions)</code></div></div><div class="nspbox"><a id="r-code-as-a-string"> </a><div><h2>R code as a string</h2></div></div><div class="nspbox"><div><p>To run any R code as string or Clojure form we use <code>clojisr.v1.r/r</code> function</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r</br>&nbsp;&nbsp;&nbsp;"mean(rnorm(100000,mean=1.0,sd=3.0))")</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;1.000041</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r</br>&nbsp;&nbsp;&nbsp;"abc&nbsp;<-&nbsp;runif(1000);</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;<-&nbsp;function(x)&nbsp;{mean(log(x))};</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f(abc)")</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;-1.019397</code></div></div><div class="nspbox"><div><p>As mentioned above, every <code>r</code> call creates RObject and R variable which keeps result of the execution.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(def&nbsp;result&nbsp;(r&nbsp;"rnorm(10)"))</code></div><div class="nspout"><code class="prettyprint lang-clj">#'clojisr.v1.codegen-test/result</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(class&nbsp;result)</code></div><div class="nspout"><code class="prettyprint lang-clj">clojisr.v1.robject.RObject</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(:object-name&nbsp;result)</code></div><div class="nspout"><code class="prettyprint lang-clj">".MEM$x16571fcb2171428e"</code></div></div><div class="nspbox"><div><p>Let's use the var name string to see what it represents.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;(:object-name&nbsp;result))</code></div><div class="nspout"><code class="prettyprint lang-clj">&nbsp;[1]&nbsp;&nbsp;1.0236690&nbsp;-0.6887702&nbsp;-1.2052135&nbsp;&nbsp;1.7124411&nbsp;-0.4615744&nbsp;-1.0273651</br>&nbsp;[7]&nbsp;&nbsp;0.9901915&nbsp;&nbsp;0.2774928&nbsp;&nbsp;1.1942463&nbsp;-0.6281645</code></div></div><div class="nspbox"><div><p>Now let us move to discussing the ROBject data type.</p></div></div><div class="nspbox"><a id="r-object"> </a><div><h2>RObject</h2></div></div><div class="nspbox"><div><p>Every RObject acts as Clojure reference to an R variable. All these variables are held in an R environment called <code>.MEM</code>. An RObject can represent anything and can be used for further evaluation, even acting as a function if it corresponds to an R function. Here are some examples:</p></div></div><div class="nspbox"><div><p>An r-object holding some R data:</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(def&nbsp;dataset&nbsp;(r&nbsp;"nhtemp"))</code></div><div class="nspout"><code class="prettyprint lang-clj">#'clojisr.v1.codegen-test/dataset</code></div></div><div class="nspbox"><div><p>An r-object holding an R function:</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(def&nbsp;function&nbsp;(r&nbsp;"mean"))</code></div><div class="nspout"><code class="prettyprint lang-clj">#'clojisr.v1.codegen-test/function</code></div></div><div class="nspbox"><div><p>Printing the data:</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">dataset</code></div><div class="nspout"><code class="prettyprint lang-clj">Time&nbsp;Series:</br>Start&nbsp;=&nbsp;1912&nbsp;</br>End&nbsp;=&nbsp;1971&nbsp;</br>Frequency&nbsp;=&nbsp;1&nbsp;</br>&nbsp;[1]&nbsp;49.9&nbsp;52.3&nbsp;49.4&nbsp;51.1&nbsp;49.4&nbsp;47.9&nbsp;49.8&nbsp;50.9&nbsp;49.3&nbsp;51.9&nbsp;50.8&nbsp;49.6&nbsp;49.3&nbsp;50.6&nbsp;48.4</br>[16]&nbsp;50.7&nbsp;50.9&nbsp;50.6&nbsp;51.5&nbsp;52.8&nbsp;51.8&nbsp;51.1&nbsp;49.8&nbsp;50.2&nbsp;50.4&nbsp;51.6&nbsp;51.8&nbsp;50.9&nbsp;48.8&nbsp;51.7</br>[31]&nbsp;51.0&nbsp;50.6&nbsp;51.7&nbsp;51.5&nbsp;52.1&nbsp;51.3&nbsp;51.0&nbsp;54.0&nbsp;51.4&nbsp;52.7&nbsp;53.1&nbsp;54.6&nbsp;52.0&nbsp;52.0&nbsp;50.9</br>[46]&nbsp;52.6&nbsp;50.2&nbsp;52.6&nbsp;51.6&nbsp;51.9&nbsp;50.5&nbsp;50.9&nbsp;51.7&nbsp;51.4&nbsp;51.7&nbsp;50.8&nbsp;51.9&nbsp;51.8&nbsp;51.9&nbsp;53.0</code></div></div><div class="nspbox"><div><p>Equivalently:</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;dataset)</code></div><div class="nspout"><code class="prettyprint lang-clj">Time&nbsp;Series:</br>Start&nbsp;=&nbsp;1912&nbsp;</br>End&nbsp;=&nbsp;1971&nbsp;</br>Frequency&nbsp;=&nbsp;1&nbsp;</br>&nbsp;[1]&nbsp;49.9&nbsp;52.3&nbsp;49.4&nbsp;51.1&nbsp;49.4&nbsp;47.9&nbsp;49.8&nbsp;50.9&nbsp;49.3&nbsp;51.9&nbsp;50.8&nbsp;49.6&nbsp;49.3&nbsp;50.6&nbsp;48.4</br>[16]&nbsp;50.7&nbsp;50.9&nbsp;50.6&nbsp;51.5&nbsp;52.8&nbsp;51.8&nbsp;51.1&nbsp;49.8&nbsp;50.2&nbsp;50.4&nbsp;51.6&nbsp;51.8&nbsp;50.9&nbsp;48.8&nbsp;51.7</br>[31]&nbsp;51.0&nbsp;50.6&nbsp;51.7&nbsp;51.5&nbsp;52.1&nbsp;51.3&nbsp;51.0&nbsp;54.0&nbsp;51.4&nbsp;52.7&nbsp;53.1&nbsp;54.6&nbsp;52.0&nbsp;52.0&nbsp;50.9</br>[46]&nbsp;52.6&nbsp;50.2&nbsp;52.6&nbsp;51.6&nbsp;51.9&nbsp;50.5&nbsp;50.9&nbsp;51.7&nbsp;51.4&nbsp;51.7&nbsp;50.8&nbsp;51.9&nbsp;51.8&nbsp;51.9&nbsp;53.0</code></div></div><div class="nspbox"><div><p>We use <code>r-&gt;clj</code> to transfer data from R to Clojure (converting an R object to Clojure data):</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r->clj&nbsp;dataset)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;49.9))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;49.9]</code></div></div><div class="nspbox"><div><p>Creating an R object, applying the function to it, and conveting to Clojure data (in this pipeline, both <code>function</code> and <code>r</code> return an RObject):</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;"c(1,2,3,4,5,6)"</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[3.5]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[3.5]]</code></div></div><div class="nspbox"><a id="clojure-forms"> </a><div><h2>Clojure forms</h2></div></div><div class="nspbox"><div><p>Calling R with the code as a string is quite limited. You can't easily inject Clojure data into the code. Also, editor support is very limited for this way of writing. So we enable the use of Clojure forms as a <a href='https://en.wikipedia.org/wiki/Domain-specific_language'>DSL</a> to simplify the construnction of R code.</p></div></div><div class="nspbox"><div><p>In generating R code from Clojure forms, <code>clojisr</code> operates on both the var and the symbol level, and can also digest primitive types and basic data structures. There are some special symbols which help in creating R <a href='https://www.dummies.com/programming/r-formulas-example/'>formulas</a> and defining R functions. We will go through all of these in detail.</p></div></div><div class="nspbox"><div><p>The <code>-&gt;code</code> function is responsible for turning Clojure forms into R code.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;[1&nbsp;2&nbsp;4]</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;->code</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"c(1,2,4)"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"c(1,2,4)"]</code></div></div><div class="nspbox"><div><p>When the <code>r</code> function gets an argument that is not a string, it uses <code>-&gt;code</code> behind the scenes to turn that argument into code as a string.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;[1&nbsp;2&nbsp;4])</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;1&nbsp;2&nbsp;4</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;[1&nbsp;2&nbsp;4]</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[1.0&nbsp;2.0&nbsp;4.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[1.0&nbsp;2.0&nbsp;4.0]]</code></div></div><div class="nspbox"><div><p>Equivalently:</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;[1&nbsp;2&nbsp;4]</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;->code</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[1.0&nbsp;2.0&nbsp;4.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[1.0&nbsp;2.0&nbsp;4.0]]</code></div></div><div class="nspbox"><div><h3>Primitive data types</h3></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;1)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[1.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[1.0]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;2.0)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[2.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[2.0]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;3/4)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[0.75]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[0.75]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;true)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[true]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[true]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;false)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[false]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[false]]</code></div></div><div class="nspbox"><div><p><code>nil</code> is converted to NULL or NA (in vectors or maps)</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;nil)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;nil))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;nil]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;nil)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"NULL"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"NULL"]</code></div></div><div class="nspbox"><div><p>When you pass a string to <code>r</code>, it is treated as code. So we have to escape double quotes if we actually mean to represent an R string (or an R character object, as it is called in R). However, when string is used inside a more complex form, it is escaped automatically.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;"\"this&nbsp;is&nbsp;a&nbsp;string\"")</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\"\"this&nbsp;is&nbsp;a&nbsp;string\"\""))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"\"\"this&nbsp;is&nbsp;a&nbsp;string\"\""]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;"\"this&nbsp;is&nbsp;a&nbsp;string\"")</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;["this&nbsp;is&nbsp;a&nbsp;string"]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;["this&nbsp;is&nbsp;a&nbsp;string"]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;'(paste</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"this&nbsp;is&nbsp;a&nbsp;string"))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"paste(\"this&nbsp;is&nbsp;a&nbsp;string\")"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"paste(\"this&nbsp;is&nbsp;a&nbsp;string\")"]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(paste&nbsp;"this&nbsp;is&nbsp;a&nbsp;string"))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;["this&nbsp;is&nbsp;a&nbsp;string"]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;["this&nbsp;is&nbsp;a&nbsp;string"]]</code></div></div><div class="nspbox"><div><p>Any <code>Named</code> Clojure object that is not a String (like a keyword or a symbol) is converted to a R symbol.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;:keyword)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"keyword"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"keyword"]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;'symb)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"symb"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"symb"]</code></div></div><div class="nspbox"><div><p>An RObject is converted to a R variable.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;(r&nbsp;"1+2"))</code></div><div class="nspout"><code class="prettyprint lang-clj">".MEM$x7089bbecbc5f4e82"</code></div></div><div class="nspbox"><div><p>Date/time is converted to a string.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;#inst&nbsp;"2031-02-03T11:22:33"</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;->code</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"'2031-02-03&nbsp;12:22:33'"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"'2031-02-03&nbsp;12:22:33'"]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;#inst&nbsp;"2031-02-03T11:22:33")</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;"2031-02-03&nbsp;12:22:33"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;#inst&nbsp;"2031-02-03T11:22:33"</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["2031-02-03&nbsp;12:22:33"]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;["2031-02-03&nbsp;12:22:33"]]</code></div></div><div class="nspbox"><div><h3>Vectors</h3></div></div><div class="nspbox"><div><p>A Clojure vector is converted to an R vector created using the <code>c</code> function. That means that nested vectors are flattened. All the values inside are translated to R recursively.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;[1&nbsp;2&nbsp;3])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"c(1,2,3)"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"c(1,2,3)"]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;[[1]&nbsp;[2&nbsp;[3]]])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[1.0&nbsp;2.0&nbsp;3.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[1.0&nbsp;2.0&nbsp;3.0]]</code></div></div><div class="nspbox"><div><p>Some Clojure sequences are interpreted as function calls, if it makes sense for their first element. However, sequences beginning with numbers or strings are treated as vectors.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;(range&nbsp;11))</code></div><div class="nspout"><code class="prettyprint lang-clj">&nbsp;[1]&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;2&nbsp;&nbsp;3&nbsp;&nbsp;4&nbsp;&nbsp;5&nbsp;&nbsp;6&nbsp;&nbsp;7&nbsp;&nbsp;8&nbsp;&nbsp;9&nbsp;10</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;(map&nbsp;str&nbsp;(range&nbsp;11)))</code></div><div class="nspout"><code class="prettyprint lang-clj">&nbsp;[1]&nbsp;"0"&nbsp;&nbsp;"1"&nbsp;&nbsp;"2"&nbsp;&nbsp;"3"&nbsp;&nbsp;"4"&nbsp;&nbsp;"5"&nbsp;&nbsp;"6"&nbsp;&nbsp;"7"&nbsp;&nbsp;"8"&nbsp;&nbsp;"9"&nbsp;&nbsp;"10"</code></div></div><div class="nspbox"><div><h4>Tagged vectors</h4></div></div><div class="nspbox"><div><p>When the first element of a vector or a sequence is a keyword starting with <code>:!</code>, some special conversion takes place.</p><table><thead><tr><th>keyword</th><th>meaning</th></tr></thead><tbody><tr><td><code>:!string</code></td><td>vector of strings</td></tr><tr><td><code>:!boolean</code></td><td>vector of logicals</td></tr><tr><td><code>:!int</code></td><td>vector of integers</td></tr><tr><td><code>:!double</code></td><td>vector of doubles</td></tr><tr><td><code>:!named</code></td><td>named vector</td></tr><tr><td><code>:!list</code></td><td>partially named list</td></tr><tr><td><code>:!call</code></td><td>treat the rest of the vector as callable sequence</td></tr><tr><td><code>:!ct</code></td><td>vector of POSIXct classes</td></tr><tr><td><code>:!lt</code></td><td>vector of POSIXlt classes</td></tr></tbody></table><p><code>nil</code> in a vector is converted to <code>NA</code></p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;[:!string&nbsp;1&nbsp;nil&nbsp;3])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;["1"&nbsp;nil&nbsp;"3"]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;["1"&nbsp;nil&nbsp;"3"]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;[:!named&nbsp;1&nbsp;2&nbsp;:abc&nbsp;3])</code></div><div class="nspout"><code class="prettyprint lang-clj">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abc&nbsp;</br>&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;3&nbsp;</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;[:!list&nbsp;:a&nbsp;1&nbsp;:b</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[:!list&nbsp;1&nbsp;2&nbsp;:c&nbsp;["a"&nbsp;"b"]]])</code></div><div class="nspout"><code class="prettyprint lang-clj">$a</br>[1]&nbsp;1</br></br>$b</br>$b[[1]]</br>[1]&nbsp;1</br></br>$b[[2]]</br>[1]&nbsp;2</br></br>$b$c</br>[1]&nbsp;"a"&nbsp;"b"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;[:!ct</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#inst&nbsp;"2011-11-01T22:33:11"])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long)</code></div><div class="nspout"><code class="prettyprint lang-clj">1320186791</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;[:!lt</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#inst&nbsp;"2011-11-01T22:33:11"])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj)</code></div><div class="nspout"><code class="prettyprint lang-clj">{:sec&nbsp;[11.0],</br>&nbsp;:min&nbsp;[33],</br>&nbsp;:hour&nbsp;[23],</br>&nbsp;:mday&nbsp;[1],</br>&nbsp;:mon&nbsp;[10],</br>&nbsp;:year&nbsp;[111],</br>&nbsp;:wday&nbsp;[2],</br>&nbsp;:yday&nbsp;[304],</br>&nbsp;:isdst&nbsp;[0],</br>&nbsp;:zone&nbsp;["CET"],</br>&nbsp;:gmtoff&nbsp;[##NaN]}</code></div></div><div class="nspbox"><div><p>When a vector is big enough, it is transfered not directly as code, but as the name of a newly created R variable holding the corresponding vector data, converted via the Java conversion layer.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;(range&nbsp;10000))</code></div><div class="nspout"><code class="prettyprint lang-clj">".MEM$x20776ddb8eb8485a"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;(conj&nbsp;(range&nbsp;10000)&nbsp;:!string))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"0"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"0"]</code></div></div><div class="nspbox"><div><p>Treat vector as callable.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;[:!call&nbsp;'mean&nbsp;[1&nbsp;2&nbsp;3&nbsp;4]])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[2.5]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[2.5]]</code></div></div><div class="nspbox"><div><h3>Maps</h3></div></div><div class="nspbox"><div><p>A Clojue Map is transformed to an R named list. As with vectors, all data elements inside are processed recursively.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;{:a&nbsp;1,&nbsp;:b&nbsp;nil})</code></div><div class="nspout"><code class="prettyprint lang-clj">$a</br>[1]&nbsp;1</br></br>$b</br>[1]&nbsp;NA</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;{:a&nbsp;1,&nbsp;:b&nbsp;nil,&nbsp;:c&nbsp;[2&nbsp;3&nbsp;4]})</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{:a&nbsp;[1.0],</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:b&nbsp;[nil],</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:c&nbsp;[2.0&nbsp;3.0&nbsp;4.0]}))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;{:a&nbsp;[1.0],&nbsp;:b&nbsp;[nil],&nbsp;:c&nbsp;[2.0&nbsp;3.0&nbsp;4.0]}]</code></div></div><div class="nspbox"><div><p>Bigger maps are transfered to R variables via the Java conversion layer.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;(zipmap&nbsp;(map&nbsp;#(str&nbsp;"key"&nbsp;%)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(range&nbsp;100))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(range&nbsp;1000&nbsp;1100)))</code></div><div class="nspout"><code class="prettyprint lang-clj">".MEM$x0554c38aa5184599"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;(zipmap&nbsp;(map&nbsp;#(str&nbsp;"key"&nbsp;%)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(range&nbsp;100))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(range&nbsp;1000&nbsp;1100)))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:key23</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[1023]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[1023]]</code></div></div><div class="nspbox"><div><h3>Calls, operators and special symbols</h3></div></div><div class="nspbox"><div><p>Now we come to the most important part, using sequences to represent function calls. One way to do that is using a list, where the first element is a symbol corresponding to the name of an R function, or an RObject corresponding to an R function. To create a function call we use the same structure as in clojure. The two examples below are are equivalent.</p></div></div><div class="nspbox"><div><p>Recall that symbols are converted to R variable names on the R side.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;"mean(c(1,2,3))")</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;2</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;'(mean&nbsp;[1&nbsp;2&nbsp;3]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;2</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(->code&nbsp;'(mean&nbsp;[1&nbsp;2&nbsp;3]))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;"mean(c(1,2,3))"))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;"mean(c(1,2,3))"]</code></div></div><div class="nspbox"><div><p>Here is another example.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;'(<-&nbsp;x&nbsp;(mean&nbsp;[1&nbsp;2&nbsp;3])))</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;2</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'x)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[2.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[2.0]]</code></div></div><div class="nspbox"><div><p>Here is another example.</p></div></div><div class="nspbox"><div><p>Recall that RObjects are converted to the names of the corresponding R objects.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->&nbsp;(list&nbsp;(r&nbsp;'median)&nbsp;[1&nbsp;2&nbsp;4])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;->code)</code></div><div class="nspout"><code class="prettyprint lang-clj">".MEM$x55ae43b3c7e14223(c(1,2,4))"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(list&nbsp;(r&nbsp;'median)&nbsp;[1&nbsp;2&nbsp;4])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[2.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[2.0]]</code></div></div><div class="nspbox"><div><p>You can call using special names (surrounded by backquote) as strings</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'("`^`"&nbsp;10&nbsp;2))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[100.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[100.0]]</code></div></div><div class="nspbox"><div><p>There are some special symbols which get a special meaning on,:</p><table><thead><tr><th>symbol</th><th>meaning</th></tr></thead><tbody><tr><td><code>function</code></td><td>R function definition</td></tr><tr><td><code>do</code></td><td>join all forms using ";"</td></tr><tr><td><code>if</code></td><td>if or if-else</td></tr><tr><td><code>tilde</code> or <code>formula</code></td><td>R formula</td></tr><tr><td><code>colon</code></td><td>colon (<code>:</code>)</td></tr><tr><td><code>bra</code></td><td><code>&#91;</code></td></tr><tr><td><code>brabra</code></td><td><code>&#91;&#91;</code></td></tr><tr><td><code>bra&lt;-</code></td><td><code>&#91;&lt;-</code></td></tr><tr><td><code>brabra&lt;-</code></td><td><code>&#91;&#91;&lt;-</code></td></tr></tbody></table></div></div><div class="nspbox"><div><h4>Function definitions</h4></div></div><div class="nspbox"><div><p>To define a function, use the <code>function</code> symbol with a following vector of argument names, and then the body. Arguments are treated as a partially named list.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;'(<-&nbsp;stat</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function&nbsp;[x&nbsp;:median&nbsp;false&nbsp;...]</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ifelse</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;median</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(median&nbsp;x&nbsp;...)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(mean&nbsp;x&nbsp;...)))))</code></div><div class="nspout"><code class="prettyprint lang-clj">function&nbsp;(x,&nbsp;median&nbsp;=&nbsp;FALSE,&nbsp;...)&nbsp;</br>{</br>&nbsp;&nbsp;&nbsp;&nbsp;ifelse(median,&nbsp;median(x,&nbsp;...),&nbsp;mean(x,&nbsp;...))</br>}</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(stat&nbsp;[100&nbsp;33&nbsp;22&nbsp;44&nbsp;55]))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[50.8]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[50.8]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(stat&nbsp;[100&nbsp;33&nbsp;22&nbsp;44&nbsp;55]</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:median</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[44.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[44.0]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(stat&nbsp;[100&nbsp;33&nbsp;22&nbsp;44&nbsp;55&nbsp;nil]))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;#(Double/isNaN&nbsp;%)))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;##NaN]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(stat&nbsp;[100&nbsp;33&nbsp;22&nbsp;44&nbsp;55&nbsp;nil]</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:na.rm</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[50.8]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[50.8]]</code></div></div><div class="nspbox"><div><p>You can use <code>if</code> with optional <code>else</code> form. Use <code>do</code> to create block of operations</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(if&nbsp;true&nbsp;11&nbsp;22))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[11.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[11.0]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(if&nbsp;false&nbsp;11&nbsp;22))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[22.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[22.0]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(if&nbsp;true&nbsp;11))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[11.0]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[11.0]]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(if&nbsp;false&nbsp;11))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;nil))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;nil]</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(r&nbsp;'(if&nbsp;true</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(do&nbsp;(<-&nbsp;x&nbsp;[1&nbsp;2&nbsp;3&nbsp;4])</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(mean&nbsp;x))))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;[2.5]))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;[2.5]]</code></div></div><div class="nspbox"><div><h4>Formulas</h4></div></div><div class="nspbox"><div><p>To create an R <a href='https://www.datacamp.com/community/tutorials/r-formula-tutorial'>formula</a>, use <code>tilde</code> or <code>formula</code> with two arguments, for the left and right sides (to skip one, just use <code>nil</code>).</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;'(formula&nbsp;y&nbsp;x))</code></div><div class="nspout"><code class="prettyprint lang-clj">y&nbsp;~&nbsp;x</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;'(formula&nbsp;y&nbsp;(|&nbsp;(+&nbsp;a&nbsp;b&nbsp;c&nbsp;d)&nbsp;e)))</code></div><div class="nspout"><code class="prettyprint lang-clj">y&nbsp;~&nbsp;a&nbsp;+&nbsp;b&nbsp;+&nbsp;c&nbsp;+&nbsp;d&nbsp;|&nbsp;e</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(r&nbsp;'(formula&nbsp;nil&nbsp;(|&nbsp;x&nbsp;y)))</code></div><div class="nspout"><code class="prettyprint lang-clj">~x&nbsp;|&nbsp;y</code></div></div><div class="nspbox"><div><h4>Operators</h4></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;'(+&nbsp;1&nbsp;2&nbsp;3&nbsp;4&nbsp;5))</code></div><div class="nspout"><code class="prettyprint lang-clj">"((((1+2)+3)+4)+5)"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;'(/&nbsp;1&nbsp;2&nbsp;3&nbsp;4&nbsp;5))</code></div><div class="nspout"><code class="prettyprint lang-clj">"((((1/2)/3)/4)/5)"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;'(-&nbsp;[1&nbsp;2&nbsp;3]))</code></div><div class="nspout"><code class="prettyprint lang-clj">"-c(1,2,3)"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;'(<-&nbsp;a&nbsp;b&nbsp;c&nbsp;123))</code></div><div class="nspout"><code class="prettyprint lang-clj">"a<-b<-c<-123"</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->code&nbsp;'($&nbsp;a&nbsp;b&nbsp;c&nbsp;d))</code></div><div class="nspout"><code class="prettyprint lang-clj">"(((a$b)$c)$d)"</code></div></div><div class="nspbox"><div><h4>Unquoting</h4></div></div><div class="nspbox"><div><p>Sometimes we want to use objects created outside our form (defined earlier or in <code>let</code>). For this case you can use the <code>unqote</code> (<code>&#126;</code>) symbol. There are two options:</p><ul><li>when using quoting <code>'</code>, unqote evaluates the uquoted form using <code>eval</code>. <code>eval</code> has some constrains, the most important is that local bindings (<code>let</code> bindings) can't be use.</li><li>when using syntax quoting (backquote `), unqote acts as in clojure macros &ndash; all unquoted forms are evaluated instantly.</li></ul></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(def&nbsp;v&nbsp;(r&nbsp;'(+&nbsp;1&nbsp;2&nbsp;3&nbsp;4)))</br>&nbsp;(r&nbsp;'(*&nbsp;22.0&nbsp;~v))</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;220</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(let&nbsp;[local-v&nbsp;(r&nbsp;'(+&nbsp;1&nbsp;2&nbsp;3&nbsp;4))</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local-list&nbsp;[4&nbsp;5&nbsp;6]]</br>&nbsp;&nbsp;&nbsp;(r&nbsp;`(*&nbsp;22.0&nbsp;~local-v&nbsp;~@local-list)))</code></div><div class="nspout"><code class="prettyprint lang-clj">[1]&nbsp;26400</code></div></div><div class="nspbox"><a id="calling-R-functions"> </a><div><h2>Calling R functions</h2></div></div><div class="nspbox"><div><p>You are not limited to the use code forms. When an RObject correspinds to an R function, it can be used and called as normal Clojure functions.</p></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(def&nbsp;square</br>&nbsp;&nbsp;&nbsp;(r&nbsp;'(function&nbsp;[x]&nbsp;(*&nbsp;x&nbsp;x))))</code></div><div class="nspout"><code class="prettyprint lang-clj">#'clojisr.v1.codegen-test/square</code></div></div><div class="nspbox"><div class="nspin"><code class="prettyprint lang-clj">(->>&nbsp;(square&nbsp;123)</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r->clj</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first</br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(check&nbsp;=&nbsp;15129.0))</code></div><div class="nspout"><code class="prettyprint lang-clj">[:PASSED&nbsp;15129.0]</code></div></div><hr /><div>Checks: <b class="PASSED">41 PASSED </b><hr /></div><div><i><small><a href="https://github.com/scicloj/clojisr/tree/master/test/clojisr/v1/codegen_test.clj">clojisr.v1.codegen-test</a> - created by <a href="https://github.com/scicloj/notespace">notespace</a>, Tue Mar 24 01:05:35 CET 2020.</small></i><hr /></div></div></body></html></html>